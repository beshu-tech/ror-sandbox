<VirtualHost *:443>
    ServerName localhost

    ErrorLog /usr/local/apache2/logs/deva-notix_error.log
    CustomLog /usr/local/apache2/logs/deva-notix_access.log combined

    SSLEngine On
    SSLCertificateFile "/usr/local/apache2/conf/certs/server.crt"
    SSLCertificateKeyFile "/usr/local/apache2/conf/certs/server.key"
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite HIGH:!aNULL:!MD5
    SSLHonorCipherOrder On

    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

    ProxyPreserveHost On
    ProxyRequests Off

    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Host "%{Host}i"
    RequestHeader set X-Forwarded-Port "443"

    SSLProxyEngine On
    SSLProxyVerify none
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerCN off

    <Proxy "balancer://deva-notix">
        BalancerMember "https://kbn-ror:5601" route=server-1 loadfactor=1 keepalive=On connectiontimeout=10 retry=2 timeout=300
        BalancerMember "https://kbn-ror-2:5601" route=server-2 loadfactor=1 keepalive=On connectiontimeout=10 retry=2 timeout=300
        ProxySet lbmethod=byrequests stickysession=ROUTEID nofailover=Off
    </Proxy>


    RewriteEngine On
    RewriteRule ^/deva-notix$ /deva-notix/ [R=301,L]
    RewriteRule ^/notix$ /deva-notix/ [R=301,L]

    RewriteRule ^/deva-notix/(.*)$ balancer://deva-notix/$1 [NC,QSA,P,L]

    Header add Set-Cookie "ROUTEID=.%{BALANCER_WORKER_ROUTE}e; Path=/; HttpOnly; SameSite=Lax" env=BALANCER_ROUTE_CHANGED
</VirtualHost>